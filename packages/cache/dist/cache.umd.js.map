{"version":3,"file":"cache.umd.js","sources":["../src/index.js"],"sourcesContent":["import express from 'express'\nimport bodyParser from 'body-parser'\nimport redis from 'redis'\n// import { promisify } from 'util'\nimport common from '@choco/express-common'\n\nconst app = express()\nconst client = redis.createClient();\n\ncommon(app)\n\nclient.on(\"error\", (error) => {\n  console.error(error)\n})\n\nfunction clientGet(key) {\n  return new Promise((resolve, reject) => {\n    client.get(key, (err, value) => {\n      if (err) reject(err)\n      resolve(value)\n    })\n  })\n}\n\n// const clientGet = promisify(client.get).bind(client)\n\napp.use(bodyParser.json()) // for parsing application/json\napp.use(bodyParser.urlencoded({ extended: true })) // for parsing application/x-www-form-urlencoded\n\napp.post('/', async(req, res) => {\n  if (req.body) {\n    try {\n      const { mode, key, value } = req.body\n      if (mode && key && value) {\n        if (mode === 'set') {\n          client.set(req.body.key, req.body.value, redis.print)\n          res.statusCode = 204\n          res.send()\n        }\n        else {\n          res.send(await clientGet(req.body.key))\n        }\n      }\n    }\n    catch(e) {\n      res.statusCode = 500\n      res.json(JSON.stringify(e))\n    }\n  }\n  else {\n    res.statusCode = 500\n    res.send('')\n  }\n})\n\napp.listen(6000)"],"names":["app","express","client","redis","createClient","common","on","error","console","clientGet","key","Promise","resolve","reject","get","err","value","use","bodyParser","json","urlencoded","extended","post","req","res","body","mode","set","print","statusCode","send","e","JSON","stringify","listen"],"mappings":";;;;;;;;;;;EAMA,MAAMA,GAAG,GAAGC,OAAO,EAAnB;EACA,MAAMC,MAAM,GAAGC,KAAK,CAACC,YAAN,EAAf;EAEAC,MAAM,CAACL,GAAD,CAAN;EAEAE,MAAM,CAACI,EAAP,CAAU,OAAV,EAAoBC,KAAD,IAAW;EAC5BC,EAAAA,OAAO,CAACD,KAAR,CAAcA,KAAd;EACD,CAFD;;EAIA,SAASE,SAAT,CAAmBC,GAAnB,EAAwB;EACtB,SAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;EACtCX,IAAAA,MAAM,CAACY,GAAP,CAAWJ,GAAX,EAAgB,CAACK,GAAD,EAAMC,KAAN,KAAgB;EAC9B,UAAID,GAAJ,EAASF,MAAM,CAACE,GAAD,CAAN;EACTH,MAAAA,OAAO,CAACI,KAAD,CAAP;EACD,KAHD;EAID,GALM,CAAP;EAMD;;;EAIDhB,GAAG,CAACiB,GAAJ,CAAQC,UAAU,CAACC,IAAX,EAAR;;EACAnB,GAAG,CAACiB,GAAJ,CAAQC,UAAU,CAACE,UAAX,CAAsB;EAAEC,EAAAA,QAAQ,EAAE;EAAZ,CAAtB,CAAR;;EAEArB,GAAG,CAACsB,IAAJ,CAAS,GAAT,EAAc,OAAMC,GAAN,EAAWC,GAAX,KAAmB;EAC/B,MAAID,GAAG,CAACE,IAAR,EAAc;EACZ,QAAI;EACF,YAAM;EAAEC,QAAAA,IAAF;EAAQhB,QAAAA,GAAR;EAAaM,QAAAA;EAAb,UAAuBO,GAAG,CAACE,IAAjC;;EACA,UAAIC,IAAI,IAAIhB,GAAR,IAAeM,KAAnB,EAA0B;EACxB,YAAIU,IAAI,KAAK,KAAb,EAAoB;EAClBxB,UAAAA,MAAM,CAACyB,GAAP,CAAWJ,GAAG,CAACE,IAAJ,CAASf,GAApB,EAAyBa,GAAG,CAACE,IAAJ,CAAST,KAAlC,EAAyCb,KAAK,CAACyB,KAA/C;EACAJ,UAAAA,GAAG,CAACK,UAAJ,GAAiB,GAAjB;EACAL,UAAAA,GAAG,CAACM,IAAJ;EACD,SAJD,MAKK;EACHN,UAAAA,GAAG,CAACM,IAAJ,EAAS,MAAMrB,SAAS,CAACc,GAAG,CAACE,IAAJ,CAASf,GAAV,CAAxB;EACD;EACF;EACF,KAZD,CAaA,OAAMqB,CAAN,EAAS;EACPP,MAAAA,GAAG,CAACK,UAAJ,GAAiB,GAAjB;EACAL,MAAAA,GAAG,CAACL,IAAJ,CAASa,IAAI,CAACC,SAAL,CAAeF,CAAf,CAAT;EACD;EACF,GAlBD,MAmBK;EACHP,IAAAA,GAAG,CAACK,UAAJ,GAAiB,GAAjB;EACAL,IAAAA,GAAG,CAACM,IAAJ,CAAS,EAAT;EACD;EACF,CAxBD;EA0BA9B,GAAG,CAACkC,MAAJ,CAAW,IAAX;;;;"}