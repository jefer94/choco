{"version":3,"file":"cache.esm.js","sources":["../src/index.js"],"sourcesContent":["import express from 'express'\nimport bodyParser from 'body-parser'\nimport redis from 'redis'\n// import { promisify } from 'util'\nimport common from '@choco/express-common'\n\nconst app = express()\nconst client = redis.createClient();\n\ncommon(app)\n\nclient.on(\"error\", (error) => {\n  console.error(error)\n})\n\nfunction clientGet(key) {\n  return new Promise((resolve, reject) => {\n    client.get(key, (err, value) => {\n      if (err) reject(err)\n      resolve(value)\n    })\n  })\n}\n\n// const clientGet = promisify(client.get).bind(client)\n\napp.use(bodyParser.json()) // for parsing application/json\napp.use(bodyParser.urlencoded({ extended: true })) // for parsing application/x-www-form-urlencoded\n\napp.post('/', async(req, res) => {\n  if (req.body) {\n    try {\n      const { mode, key, value } = req.body\n      if (mode && key && value) {\n        if (mode === 'set') {\n          client.set(req.body.key, req.body.value, redis.print)\n          res.statusCode = 204\n          res.send()\n        }\n        else {\n          res.send(await clientGet(req.body.key))\n        }\n      }\n    }\n    catch(e) {\n      res.statusCode = 500\n      res.json(JSON.stringify(e))\n    }\n  }\n  else {\n    res.statusCode = 500\n    res.send('')\n  }\n})\n\napp.listen(6000)"],"names":["app","express","client","redis","createClient","common","on","error","console","clientGet","key","Promise","resolve","reject","get","err","value","use","bodyParser","json","urlencoded","extended","post","req","res","body","mode","set","print","statusCode","send","e","JSON","stringify","listen"],"mappings":";;;;;AAMA,MAAMA,GAAG,GAAGC,OAAO,EAAnB;AACA,MAAMC,MAAM,GAAGC,KAAK,CAACC,YAAN,EAAf;AAEAC,MAAM,CAACL,GAAD,CAAN;AAEAE,MAAM,CAACI,EAAP,CAAU,OAAV,EAAoBC,KAAD,IAAW;AAC5BC,EAAAA,OAAO,CAACD,KAAR,CAAcA,KAAd;AACD,CAFD;;AAIA,SAASE,SAAT,CAAmBC,GAAnB,EAAwB;AACtB,SAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCX,IAAAA,MAAM,CAACY,GAAP,CAAWJ,GAAX,EAAgB,CAACK,GAAD,EAAMC,KAAN,KAAgB;AAC9B,UAAID,GAAJ,EAASF,MAAM,CAACE,GAAD,CAAN;AACTH,MAAAA,OAAO,CAACI,KAAD,CAAP;AACD,KAHD;AAID,GALM,CAAP;AAMD;;;AAIDhB,GAAG,CAACiB,GAAJ,CAAQC,UAAU,CAACC,IAAX,EAAR;;AACAnB,GAAG,CAACiB,GAAJ,CAAQC,UAAU,CAACE,UAAX,CAAsB;AAAEC,EAAAA,QAAQ,EAAE;AAAZ,CAAtB,CAAR;;AAEArB,GAAG,CAACsB,IAAJ,CAAS,GAAT,EAAc,OAAMC,GAAN,EAAWC,GAAX,KAAmB;AAC/B,MAAID,GAAG,CAACE,IAAR,EAAc;AACZ,QAAI;AACF,YAAM;AAAEC,QAAAA,IAAF;AAAQhB,QAAAA,GAAR;AAAaM,QAAAA;AAAb,UAAuBO,GAAG,CAACE,IAAjC;;AACA,UAAIC,IAAI,IAAIhB,GAAR,IAAeM,KAAnB,EAA0B;AACxB,YAAIU,IAAI,KAAK,KAAb,EAAoB;AAClBxB,UAAAA,MAAM,CAACyB,GAAP,CAAWJ,GAAG,CAACE,IAAJ,CAASf,GAApB,EAAyBa,GAAG,CAACE,IAAJ,CAAST,KAAlC,EAAyCb,KAAK,CAACyB,KAA/C;AACAJ,UAAAA,GAAG,CAACK,UAAJ,GAAiB,GAAjB;AACAL,UAAAA,GAAG,CAACM,IAAJ;AACD,SAJD,MAKK;AACHN,UAAAA,GAAG,CAACM,IAAJ,EAAS,MAAMrB,SAAS,CAACc,GAAG,CAACE,IAAJ,CAASf,GAAV,CAAxB;AACD;AACF;AACF,KAZD,CAaA,OAAMqB,CAAN,EAAS;AACPP,MAAAA,GAAG,CAACK,UAAJ,GAAiB,GAAjB;AACAL,MAAAA,GAAG,CAACL,IAAJ,CAASa,IAAI,CAACC,SAAL,CAAeF,CAAf,CAAT;AACD;AACF,GAlBD,MAmBK;AACHP,IAAAA,GAAG,CAACK,UAAJ,GAAiB,GAAjB;AACAL,IAAAA,GAAG,CAACM,IAAJ,CAAS,EAAT;AACD;AACF,CAxBD;AA0BA9B,GAAG,CAACkC,MAAJ,CAAW,IAAX"}